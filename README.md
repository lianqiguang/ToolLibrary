# 工具库(Tool Library)

2025-6-26

*此工具库目的是自己动手实现相关功能，形成自己的工具，能够在以后的编程中复用。*

### 一、Json 解析器

​	*目前是基于C++实现了解析器的一部分。*







### 二、Log 日志库

*目前是基于C函数实现的日志库，当前实现缺少线程安全机制，多线程环境下可能导致日志内容混乱或程序崩溃。*



#### 提升方向：

##### 	1.线程安全优化

​		**互斥锁保护**：在log()方法中添加`std::mutex`保护共享资源。

​		**双缓冲技术**：采用生产者-消费者模式，使用两个缓冲区交替读写，减少锁竞争。

​		**线程局部存储**：为每个线程分配独立缓冲区，最后合并写入，避免频繁同步。

##### 	2.异步日志机制

​		**异步线程池**：创建专用线程处理日志I/O，主线程只将日志放入队列

​		**无锁队列**：使用`moodycamel::ConcurrentQueue`等高性能无锁队列实现异步传输

​		**溢出策略**：设置队列满时的处理策略（阻塞/丢弃新日志/覆盖旧日志)

##### 	3.日志格式化优化

​		**采用`fmtlib`**：集成高性能的`{fmt}`库，提供类型安全、更高效的格式化。

​		**编译期格式检查**：利用C++20的`std::format`或`{fmt}`的编译时检查功能

​		**自定义格式模式**：支持用户自定义时间戳、线程ID等字段的显示格式

##### 	4.日志文件管理

​		**多维度轮转策略**：按大小、时间(小时/天)、同时满足大小和时间条件

​		**自动压缩归档**：对旧日志文件自动压缩节省空间

​		**日志清理策略**：基于数量或存储期限的自动清理机制

##### 	5.性能优化细节

​		**批量写入**：积累多条日志后一次性写入，减少I/O操作次数

​		**内存映射文件**：对频繁写入的日志文件使用`mmap`提升性能

​		**日志级别过滤**：在格式化前检查级别，避免不必要的格式化开销

​		**热更新配置**：支持运行时动态修改日志级别、输出目标等配置

##### 	6.功能扩展建议

​		**多输出目标**：支持同时输出到控制台、文件、网络、系统日志等

​		**日志回调**：允许用户注册回调函数处理特定日志

​		**崩溃安全**：确保程序异常退出时不丢失最后几条关键日志

​		**性能统计**：内置日志吞吐量、延迟等统计信息

##### 	7.集成现代C++特性

​		**移动语义**：使用`std::move`传递日志消息，避免拷贝

​		**RAII管理资源**：用智能指针管理文件、线程等资源

​		**类型安全枚举**：增强`Level`枚举的类型安全性
